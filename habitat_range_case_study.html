<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gawain T. Antell. Adapted by Thomas J. Smith">

<title>Habitat range case study</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="habitat_range_case_study_files/libs/clipboard/clipboard.min.js"></script>
<script src="habitat_range_case_study_files/libs/quarto-html/quarto.js"></script>
<script src="habitat_range_case_study_files/libs/quarto-html/popper.min.js"></script>
<script src="habitat_range_case_study_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="habitat_range_case_study_files/libs/quarto-html/anchor.min.js"></script>
<link href="habitat_range_case_study_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="habitat_range_case_study_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="habitat_range_case_study_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="habitat_range_case_study_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="habitat_range_case_study_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Habitat range case study</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gawain T. Antell. Adapted by Thomas J. Smith </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="goals-and-limitations-of-the-vignette" class="level2">
<h2 class="anchored" data-anchor-id="goals-and-limitations-of-the-vignette">Goals and limitations of the vignette</h2>
<p>This vignette is written to model a realistic project flow for ecological occurrence data, providing example uses of <code>divvy</code> functions in <code>R</code> code chunks to analyse geographic range size disparities between comparison categories. The data and hypothesis are representative of many real palaeobiology studies, with the hope of serving as a template for comparing ecology between environments, regions, or clades—for instance, investigations about whether diversity was greater in Gondwanaland or Laurasia, or whether biogeographic connectedness was greater within reefal or non-reefal assemblages.</p>
<p>Results herein should not be taken as a conclusive answer to the example research question. For a publication-quality study, ideally one would further vet both taxonomic and environmental assignments in the original public database download, for instance. Similarly, while this vignette illustrates two lines of analysis, additional follow-up inquiries would be prudent to pursue before arguing a definitive palaeoecological interpretation of the results to the research community.</p>
</section>
<section id="background-on-geographic-ranges-between-marine-environments" class="level2">
<h2 class="anchored" data-anchor-id="background-on-geographic-ranges-between-marine-environments">1. Background on geographic ranges between marine environments</h2>
<p>Palaeobiologists often track ecological parameters through time, where, as the main <code>divvy</code> package vignette illustrates, it is crucial to standardise differences in spatial coverage between time steps. However, it is equally important to apply spatial standardisation for comparisons between environment or habitat types, even if data occur within one time step. For instance, consider two habitat types that cover different geographic extents. To determine fairly which habitat hosts more diverse communities, one must account for the difference in spatial coverage. By first subsampling each habitat type into equivalent spatial units, one can then directly and fairly compare richness or other ecological metrics between environments.</p>
<p>In the marine realm, one of the most important environmental axes of ecological differentiation is water depth. Diversity, geographic range size, and other aspects of community structure vary along a gradient of near-shore to deep-water environments. Here, we divide this environmental spectrum coarsely into shallow (proximal) vs.&nbsp;deep (distal) marine habitats. ‘Shallow’ habitats encompass deltaic, (sub)tidal, and shelf margin environments. ‘Deep’ habitats include continental slope and offshore settings, generally beginning at 140 m <span class="citation" data-cites="Duran2018">(<a href="#ref-Duran2018" role="doc-biblioref">Durán and Guillén 2018</a>)</span>.</p>
<p>The ecological attribute this case study focusses on is geographic range size, a trait with widespread importance. For instance, range size determines extinction risk to a large degree <span class="citation" data-cites="Harnik2012 Saupe2015">(<a href="#ref-Harnik2012" role="doc-biblioref">Harnik, Simpson, and Payne 2012</a>; <a href="#ref-Saupe2015" role="doc-biblioref">Saupe et al. 2015</a>)</span>. Range size might influence origination propensity as well, although researchers dispute whether this relationship is positive <span class="citation" data-cites="Rosenzweig1995 Maurer2001">(<a href="#ref-Rosenzweig1995" role="doc-biblioref">Rosenzweig 1995</a>; <a href="#ref-Maurer2001" role="doc-biblioref">Maurer and Nott 2001</a>)</span>, negative <span class="citation" data-cites="Hansen1980 Jablonski2003">(<a href="#ref-Hansen1980" role="doc-biblioref">Hansen 1980</a>; <a href="#ref-Jablonski2003" role="doc-biblioref">Jablonski and Roy 2003</a>)</span>, or unimodal <span class="citation" data-cites="Gaston2003 Allmon2014">(<a href="#ref-Gaston2003" role="doc-biblioref">Gaston 2003</a>; <a href="#ref-Allmon2014" role="doc-biblioref">Allmon and Martin 2014</a>)</span>.</p>
<p>The environmental niche breadth of a taxon strongly controls its geographic distribution; the maximum attainable extent of a taxon’s range size is the extent of occurrence of that taxon’s suitable habitat. Two consequences of this relationship are that (1) taxa with broad niches (generalists or eurytopic taxa) are expected to occupy larger ranges than those with narrow niches (specialists or stenotopic taxa), and (2) for environments within a given specialisation, a larger geographic distribution of those habitats permits taxa to occupy larger ranges. Taxa may be more restricted than suitable environmental conditions would predict (realised niche breadth), due to biotic or historic factors, but taxa cannot exceed the bounds set by environmental suitability. Since environmental characteristics are more homogeneous in the cold, dark waters of the deep sea than in the topologic complexity of shallow settings, ecologists have long theorised geographic ranges to be larger for deep-dwelling than shallow-water species <span class="citation" data-cites="Coe1946 McClain2010 Costello2017">(<a href="#ref-Coe1946" role="doc-biblioref">Coe 1946</a>; <a href="#ref-McClain2010" role="doc-biblioref">McClain and Hardy 2010</a>; <a href="#ref-Costello2017" role="doc-biblioref">Costello and Chaudhary 2017</a>)</span>. Most empirical tests of this hypothesis have relied upon modern data, however, with relatively little evidence from periods of Earth history when ocean circulation and continental configuration were entirely unlike those of today.</p>
<p><a id="atlas_map" href=""></a> The following sections walk through an analysis to test the expectations geographic ranges are wider for (1) eurytopic than stenotopic taxa and (2) deep- than shallow-water taxa, using brachiopod occurrences from the Silurian (444-419 Ma) recorded in the <a href="https://paleobiodb.org/">Paleobiology Database</a> (PBDB). Brachiopoda was a diverse clade that made up a large component of Paleozoic benthic communities <span class="citation" data-cites="Close2020 Rojas2021">(<a href="#ref-Close2020" role="doc-biblioref">Close et al. 2020</a>; <a href="#ref-Rojas2021" role="doc-biblioref">Rojas et al. 2021</a>)</span>. In the Paleozoic, much of the world’s landmass had coalesced at southermost latitudes into Gondwanaland, with the remaining continents scattered at the equator and separated by the Iapetus, Paleo-Tethys, Rheic, and Panthalassic oceans (map below). Hence, the geometry of a cosmopolitan marine species’ range from the Silurian would differ distinctly from a cosmopolitan range today. Spatial subsampling is crucial to addressing the research questions because the preserved area and distribution of shallow and deep-water habitats also differ from each other.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="PALEOMAP_atlas_map75a_Llandovery_430.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><em>Silurian palaeogeography, as reconstructed by the PALEOMAP PaleoAtlas project <span class="citation" data-cites="Scotese2016">(<a href="#ref-Scotese2016" role="doc-biblioref">Scotese 2016</a>)</span>.</em></figcaption>
</figure>
</div>
</section>
<section id="prepare-taxonomic-occurrence-data" class="level2">
<h2 class="anchored" data-anchor-id="prepare-taxonomic-occurrence-data">2.Prepare taxonomic occurrence data</h2>
<p>PBDB downloads of (1) all marine collections and (2) all Brachiopoda occurrences with accepted names at genus-ranking or below are available as attached datasets in the <code>divvy</code> package. Both datasets are subset to relevant columns and are cleaned to remove records missing coordinates. For more information, load the package and query the data objects from the console with <code>?collSilur</code> and <code>?occSilur</code>. The script to download and vet the raw data is available as <code>format-data.R</code> within the GitHub repository <a href="https://github.com/GawainAntell/divvy/tree/main/data-raw">data-raw folder (link)</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># terra and sf have all the necessary helper functions for spatial operations</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>terra 1.7.46</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(divvy)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(collSilur)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(occSilur)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The taxonomic hierarchy and stratigraphic ranges of the occurrence data are standardised against the Sepkoski Compendium already, following the <code>fossilbrush</code> package vignette <span class="citation" data-cites="fossilbrush">(<a href="#ref-fossilbrush" role="doc-biblioref">Flannery-Sutherland et al. 2022</a>)</span>. A further element of cleaning is removal of taxa that occur only once (‘space-time singletons’ <em>sensu</em> <span class="citation" data-cites="Antell2020">Antell et al. (<a href="#ref-Antell2020" role="doc-biblioref">2020</a>)</span>). These records contain insufficient information to contribute to geographic range-size calculations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>nmFreq <span class="ot">&lt;-</span> <span class="fu">table</span>(occSilur<span class="sc">$</span>genus)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>sss <span class="ot">&lt;-</span> nmFreq[nmFreq <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">|&gt;</span> <span class="fu">names</span>()</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>sssRows <span class="ot">&lt;-</span> occSilur<span class="sc">$</span>genus <span class="sc">%in%</span> sss</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>occSilur <span class="ot">&lt;-</span> occSilur[ <span class="sc">!</span>sssRows, ]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(sss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 52</code></pre>
</div>
</div>
<p>This step removes 52 taxa with singular occurrence records.</p>
<p>To disregard trivial differences in coordinate values between points from the same or adjacent localities, the next data treatment is conversion of vector (point) data to raster grid cells. For each PBDB record, the ID and centroid coordinates of its encompassing raster cell are saved in new columns. These cell values will be used in spatial calculations later to improve computation time substantially compared to operations on vector point data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialise Equal Earth projected coordinates</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>rWorld <span class="ot">&lt;-</span> <span class="fu">rast</span>()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>prj <span class="ot">&lt;-</span> <span class="st">'EPSG:8857'</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>rPrj <span class="ot">&lt;-</span> <span class="fu">project</span>(rWorld, prj, <span class="at">res =</span> <span class="dv">200000</span>) <span class="co"># 200,000m is approximately 2 degrees</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(rPrj) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncell</span>(rPrj)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># coordinate column names for the current and target coordinate reference system</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>xyCartes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'paleolng'</span>,<span class="st">'paleolat'</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>xyCell   <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'cellX'</span>,<span class="st">'cellY'</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># collection data</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>llColl <span class="ot">&lt;-</span> <span class="fu">vect</span>(collSilur, <span class="at">geom =</span> xyCartes, <span class="at">crs =</span> <span class="st">'epsg:4326'</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>prjColl <span class="ot">&lt;-</span> <span class="fu">project</span>(llColl, prj)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>collSilur<span class="sc">$</span>cell <span class="ot">&lt;-</span> <span class="fu">cells</span>(rPrj, prjColl)[,<span class="st">'cell'</span>]</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>collSilur[, xyCell] <span class="ot">&lt;-</span> <span class="fu">xyFromCell</span>(rPrj, collSilur<span class="sc">$</span>cell)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co"># taxon occurrences</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>llOccs <span class="ot">&lt;-</span> <span class="fu">vect</span>(occSilur, <span class="at">geom =</span> xyCartes, <span class="at">crs =</span> <span class="st">'epsg:4326'</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>prjOccs <span class="ot">&lt;-</span> <span class="fu">project</span>(llOccs, prj)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>occSilur<span class="sc">$</span>cell <span class="ot">&lt;-</span> <span class="fu">cells</span>(rPrj, prjOccs)[,<span class="st">'cell'</span>]</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>occSilur[, xyCell] <span class="ot">&lt;-</span> <span class="fu">xyFromCell</span>(rPrj, occSilur<span class="sc">$</span>cell)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="categorise-environment-associated-with-occurrences" class="level2">
<h2 class="anchored" data-anchor-id="categorise-environment-associated-with-occurrences">3. Categorise environment associated with occurrences</h2>
<p>To compare ecological parameters between preferred environments, the 23 categories in the PBDB <code>environment</code> field must first be reclassified as a binary variable for proximal and deep-water settings. The following division of marine environments is copied from scripts of <span class="citation" data-cites="Antell2020">Antell et al. (<a href="#ref-Antell2020" role="doc-biblioref">2020</a>)</span>, who adapted the classification of <span class="citation" data-cites="Nurnberg2013">Nürnberg and Aberhan (<a href="#ref-Nurnberg2013" role="doc-biblioref">2013</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>proxTerms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"coastal indet."</span>, <span class="st">"delta front"</span>, <span class="st">"delta plain"</span>,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"deltaic indet."</span>, <span class="st">"estuary/bay"</span>, <span class="st">"foreshore"</span>, <span class="st">"interdistributary bay"</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"lagoonal"</span>, <span class="st">"lagoonal/restricted shallow subtidal"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">"marginal marine indet."</span>, <span class="st">"open shallow subtidal"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">"fluvial-deltaic indet."</span>, <span class="st">"paralic indet."</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">"peritidal"</span>, <span class="st">"prodelta"</span>, <span class="st">"sand shoal"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>               <span class="st">"shallow subtidal indet."</span>, <span class="st">"shoreface"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>               <span class="st">"transition zone/lower shoreface"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>               <span class="st">"intrashelf/intraplatform reef"</span>, <span class="st">"reef, buildup or bioherm"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>               <span class="st">"perireef or subreef"</span>, <span class="st">"platform/shelf-margin reef"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>deepTerms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"basinal (carbonate)"</span>, <span class="st">"basinal (siliceous)"</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>               <span class="st">"basinal (siliciclastic)"</span>, <span class="st">"deep-water indet."</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>               <span class="st">"deep subtidal indet."</span>, <span class="st">"deep subtidal ramp"</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>               <span class="st">"deep subtidal shelf"</span>, <span class="st">"offshore"</span>, <span class="st">"offshore indet."</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>               <span class="st">"offshore shelf"</span>, <span class="st">"slope"</span>, <span class="st">"submarine fan"</span>, <span class="st">"offshore ramp"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>               <span class="st">"basin reef"</span>, <span class="st">"slope/ramp reef"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The most accurate environmental information will be that associated directly with occurrence records. Where available, that is the information this script will prioritise. However, there are many instances of a blank or indeterminate <code>environment</code> field. In those cases, a way to infer probable environment is to determine the predominant environment in the local grid cell based on the environment recorded from any PBDB collections in that cell. A collection in the PBDB can contain any number of occurrences of any number of clades but is tied to a point coordinate—therefore, collections are a rich source of environmental data that is largely independent of occurrences for an individual clade.</p>
<p><code>divvy</code> provides the <code>classRast()</code> function to convert environmental occurrence points to a raster grid with a dominant environmental class in each cell. In the use below, the function classifies grid cells as proximal or deep-water whenever more than 80% of collections are affiliated with a single environment. The template raster passed to <code>classRast()</code> here has the same resolution, extent, and coordinate reference system as applied above to the occurrence data. <a id="raster_map" href=""></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>collSilur<span class="sc">$</span>bath <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>collSilur<span class="sc">$</span>bath[collSilur<span class="sc">$</span>environment <span class="sc">%in%</span> proxTerms] <span class="ot">&lt;-</span> <span class="st">'prox'</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>collSilur<span class="sc">$</span>bath[collSilur<span class="sc">$</span>environment <span class="sc">%in%</span> deepTerms] <span class="ot">&lt;-</span> <span class="st">'deep'</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>bathRast <span class="ot">&lt;-</span> <span class="fu">classRast</span>(rPrj, <span class="at">dat =</span> collSilur, <span class="at">cutoff =</span> <span class="fl">0.8</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xy =</span> xyCell, <span class="at">env =</span> <span class="st">'bath'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bathRast, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#1B9E77"</span>, <span class="st">"#D95F02"</span>, <span class="st">"black"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="habitat_range_case_study_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="figure" style="text-align: center">
<p><img src="classify-collections-enviro-1.png" alt="World map where a mix of grid cells labelled deep, shallow, and indeterminate are scattered around the outline of Gondwanaland and Laurasia. Most of the points fall close to the coastlines and are concentrated around Laurasia." width="650" height="325"></p>
<p class="caption">
</p><p><em>Predominant environment recorded in PBDB collections</em></p>
<p></p>
</div>
<p>A plot of the environmental distribution inferred from collection data traces the mid-latitude continents <a href="#atlas_map">(figured above)</a>, albeit with gaps. Very few occurrences appear along the coasts of Gondwanaland, perhaps largely due to the under-sampling and under-reporting of the corresponding modern continents relative to North America and Europe. Also note that sampling of northern extents of Laurasia occurs almost exclusively in deep-water settings.</p>
<p>It is now possible to infer binary water depth for brachiopod occurrence records. Where available, the classification will reflect the environment directly associated with occurrences, and otherwise will be inferences from the collections-based raster.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a new 'bathCell' column to note the collections-inferred environment</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>occSilur<span class="sc">$</span>bathCell <span class="ot">&lt;-</span> occSilur<span class="sc">$</span>bath <span class="ot">&lt;-</span> <span class="fu">extract</span>(bathRast, prjOccs)[[<span class="st">'mainClass'</span>]]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># refine the enviro where possible based on observations directly linked to occs</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>occSilur<span class="sc">$</span>bath[occSilur<span class="sc">$</span>environment <span class="sc">%in%</span> proxTerms] <span class="ot">&lt;-</span> <span class="st">'prox'</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>occSilur<span class="sc">$</span>bath[occSilur<span class="sc">$</span>environment <span class="sc">%in%</span> deepTerms] <span class="ot">&lt;-</span> <span class="st">'deep'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A quick inspection reveals roughly equal numbers of occurrences in each environment. However, there are half again as many shallow as deep-water grid cells as indicated by all marine collections—a result that points to the necessity of subsampling. Without accounting for the greater observation of proximal habitats, if shallow-water specialists turn out to have equal or larger geographic occupancies than deep-water specialists it might be impossible to tell if this result is due purely to sampling or also to ecology.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(occSilur<span class="sc">$</span>bath) <span class="co"># environment inferred directly from records</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  deep   prox indet. 
  4966   4124   2035 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">freq</span>(bathRast, <span class="at">bylayer =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   value count
1   deep   141
2   prox   226
3 indet.    70</code></pre>
</div>
</div>
<p>Inspection also reveals the majority of environments inferred from collection data nearby do match the environments associated with occurrence records directly. Most of the discrepancies occur when collection-derived environment was indeterminate and occurrence data contained specific environment terms.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># what proportion of environments associated with individual records</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># match environmental inferences from nearby collections' data?</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(occSilur<span class="sc">$</span>bath <span class="sc">==</span> occSilur<span class="sc">$</span>bathCell) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>()<span class="sc">/</span><span class="fu">nrow</span>(occSilur)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6516729</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare number of indeterminate enviro from collections vs above from records</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(occSilur<span class="sc">$</span>bathCell)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  deep   prox indet. 
  3616   3330   4158 </code></pre>
</div>
</div>
</section>
<section id="assign-per-taxon-environmental-preferences" class="level2">
<h2 class="anchored" data-anchor-id="assign-per-taxon-environmental-preferences">4. Assign per-taxon environmental preferences</h2>
<p>Now that the data are standardised to the same raster gridding and environmental classification, it is possible to infer the environmental preferences and niche breadth of all taxa. The custom function below labels a focal taxon as a specialist for an environment if more than a threshold proportion of its occurrences (here, 70%) lie within a single habitat type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># categorise preferences as binary or nonspecific/eurytopic</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>pref <span class="ot">&lt;-</span> <span class="cf">function</span>(env, cutoff){</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  envTbl <span class="ot">&lt;-</span> <span class="fu">table</span>(env)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sum</span>(envTbl[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])<span class="sc">==</span><span class="dv">0</span>) { <span class="st">'unk'</span> } <span class="cf">else</span> {</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    envTbl <span class="ot">&lt;-</span> envTbl[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">/</span> <span class="fu">sum</span>(envTbl[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) <span class="co"># proportional enviro abundance</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(envTbl[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">&gt;</span> cutoff)) { <span class="co"># check if either envrio is predominant</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(envTbl[[<span class="dv">1</span>]] <span class="sc">&gt;</span> cutoff, <span class="fu">names</span>(envTbl)[<span class="dv">1</span>], <span class="fu">names</span>(envTbl)[<span class="dv">2</span>])</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> { <span class="st">'both'</span> }</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The bathymetry column of occurrences is an ordered factor, so levels</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 and 2 subset by the function correspond to the two environment types</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(occSilur<span class="sc">$</span>bath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "deep"   "prox"   "indet."</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tag each row as from a taxon with deep, proximal, or eurytopic preference</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>taxa <span class="ot">&lt;-</span> <span class="fu">unique</span>(occSilur<span class="sc">$</span>genus)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>occSilur<span class="sc">$</span>pref <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>cutoff <span class="ot">&lt;-</span> <span class="fl">0.7</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (tax <span class="cf">in</span> taxa){</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a> taxBool <span class="ot">&lt;-</span> occSilur<span class="sc">$</span>genus <span class="sc">==</span> tax</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a> envOccs <span class="ot">&lt;-</span> occSilur<span class="sc">$</span>bath[taxBool]</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a> occSilur<span class="sc">$</span>pref[taxBool] <span class="ot">&lt;-</span> <span class="fu">pref</span>(envOccs, cutoff)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A simple way to split the data into comparison groups used in analysis below is to divide the occurrence dataset into three <code>data.frame</code>s: one for deep-water specialists, one for proximal-environment specialists, and one for eurytopic taxa with respect to depth. This data structure is straightforward to illustrate subsampling in the section below but is not the only way to proceed with analysis; for instance, one could organise the data subsets in a <code>list</code> or <code>array</code> instead, and then perform subsampling across that structure’s indices.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>deep <span class="ot">&lt;-</span> occSilur[ occSilur<span class="sc">$</span>pref <span class="sc">==</span> <span class="st">'deep'</span>, ] <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uniqify</span>(<span class="at">taxVar =</span> <span class="st">'genus'</span>, <span class="at">xy =</span> xyCell)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>prox <span class="ot">&lt;-</span> occSilur[ occSilur<span class="sc">$</span>pref <span class="sc">==</span> <span class="st">'prox'</span>, ] <span class="sc">|&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uniqify</span>(<span class="at">taxVar =</span> <span class="st">'genus'</span>, <span class="at">xy =</span> xyCell)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>eury <span class="ot">&lt;-</span> occSilur[ occSilur<span class="sc">$</span>pref <span class="sc">==</span> <span class="st">'both'</span>, ] <span class="sc">|&gt;</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uniqify</span>(<span class="at">taxVar =</span> <span class="st">'genus'</span>, <span class="at">xy =</span> xyCell)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># the divvy uniqify() function removes duplicate taxon-cell combinations</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># for smaller memory use and faster calculations below</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># how many taxa specialise in each?</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>taxaD <span class="ot">&lt;-</span> <span class="fu">unique</span>(deep<span class="sc">$</span>genus)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>taxaP <span class="ot">&lt;-</span> <span class="fu">unique</span>(prox<span class="sc">$</span>genus)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>taxaE <span class="ot">&lt;-</span> <span class="fu">unique</span>(eury<span class="sc">$</span>genus)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">length</span>(taxaD), <span class="st">'deep;'</span>, <span class="fu">length</span>(taxaP), <span class="st">'shallow;'</span>, <span class="fu">length</span>(taxaE), <span class="st">'both'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "94 deep; 61 shallow; 100 both"</code></pre>
</div>
</div>
<p>The 70% threshold used to define taxon affinities leads to approximately equal numbers of deep and eurytopic taxa and a smaller sample of proximal specialists.</p>
</section>
<section id="spatially-subsample-each-environment" class="level2">
<h2 class="anchored" data-anchor-id="spatially-subsample-each-environment">5. Spatially subsample each environment</h2>
<p>It is now an appropriate point in the workflow to standardise the spatial coverage of occurrences in each comparison group. <code>divvy</code> provides several options of spatial subsampling functions; in the code chunk below, we apply the <code>cookies()</code> subsampling routine to the datasets of deep, proximal, and eurytopic taxa. The arguments <code>reps</code>, <code>siteQuota</code>, and <code>radius</code> define the number of subsampling iterations run, the number of localities to include in each subsample, and the maximum radius of each circular subsampling region, respectively.</p>
<p>The value of <code>reps</code> is set at a number high enough to ensure all possible points are captured in at least one subsample, while keeping the returned object (list of subsampled <code>data.frame</code>s) at a manageable size. Increasing the number of <code>reps</code> only slightly prolongs the computational time of subsampling but will linearly slow the runtime of range-size calculations on subsamples in the following sections. In Phanerozoic analyses, <span class="citation" data-cites="Antell2020">Antell et al. (<a href="#ref-Antell2020" role="doc-biblioref">2020</a>)</span> performed 500 replicates of circular subsampling per time step, and <span class="citation" data-cites="Close2017">Close et al. (<a href="#ref-Close2017" role="doc-biblioref">2017</a>)</span> did 100 (20 replicates from each of 5 regions defined by minimum spanning trees).</p>
<p>The values of <code>siteQuota</code> and <code>radius</code> are a trade-off between increasing the sample size of localities within each subsample to precisely characterise geographic ranges while limiting the total extent of the subsampling region not to exceed the approximate size of an ocean basin or biogeographic zone.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>reps <span class="ot">&lt;-</span> <span class="dv">500</span> <span class="co"># number of subsamples to draw</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>siteQuota <span class="ot">&lt;-</span> <span class="dv">15</span> <span class="co"># number of sites (equal-area grid cells) in each subsample</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co"># radial distance in km</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>sampD <span class="ot">&lt;-</span> <span class="fu">cookies</span>(<span class="at">dat =</span> deep,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xy =</span> xyCell, <span class="at">iter =</span> reps,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">nSite =</span> siteQuota,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">r =</span> r, <span class="at">weight =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">crs =</span> prj, <span class="at">output =</span> <span class="st">'full'</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>sampP <span class="ot">&lt;-</span> <span class="fu">cookies</span>(<span class="at">dat =</span> prox,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xy =</span> xyCell, <span class="at">iter =</span> reps,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">nSite =</span> siteQuota,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">r =</span> r, <span class="at">weight =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">crs =</span> prj, <span class="at">output =</span> <span class="st">'full'</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>sampE <span class="ot">&lt;-</span> <span class="fu">cookies</span>(<span class="at">dat =</span> eury,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xy =</span> xyCell, <span class="at">iter =</span> reps,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">nSite =</span> siteQuota,</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">r =</span> r, <span class="at">weight =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">crs =</span> prj, <span class="at">output =</span> <span class="st">'full'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For further details of subsampling using <code>divvy</code>, including the <code>clustr()</code> function to define subsamples based on minimum spanning tree diameter instead of circular regional constraints, consult the other vignettes and <span class="citation" data-cites="Antell2023">Antell, Benson, and Saupe (<a href="#ref-Antell2023" role="doc-biblioref">accepted</a>)</span>.</p>
</section>
<section id="summed-common-occurrence-rate-between-environments" class="level2">
<h2 class="anchored" data-anchor-id="summed-common-occurrence-rate-between-environments">6. Summed Common Occurrence Rate between environments</h2>
<p>We need to parameterise geographic range sizes in some way to make quantitative comparisons between ecological groups. One way to do so is with a measure of cosmopolitanism calculated on assemblage-level data (rather than individual taxa), such as the Summed Common species/taxon Occurrence Rate (SCOR). SCOR reflects the degree to which taxa are common/widespread and is decoupled from richness or abundance <span class="citation" data-cites="Hannisdal2012">(<a href="#ref-Hannisdal2012" role="doc-biblioref">Hannisdal, Henderiks, and Liow 2012</a>)</span>. <code>divvy</code> provides the <code>sdSumry()</code> function to compute summary statistics about the geographic coverage and diversity of a dataset, including SCOR; conveniently, <code>sdSumry()</code> can take a <code>list</code> of subsampled occurrence data subsets as its data argument and return a single <code>data.frame</code> with columns for the summary variables and a row for each subsample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>metaD <span class="ot">&lt;-</span> <span class="fu">sdSumry</span>(sampD, xyCell, <span class="st">'genus'</span>, prj)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>metaP <span class="ot">&lt;-</span> <span class="fu">sdSumry</span>(sampP, xyCell, <span class="st">'genus'</span>, prj)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>metaE <span class="ot">&lt;-</span> <span class="fu">sdSumry</span>(sampE, xyCell, <span class="st">'genus'</span>, prj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>SCOR is calculated as the sum across taxa of the log probability of incidence: very widespread taxa make a large contribution to an assemblage SCOR, while rare taxa have relatively little influence. When a taxon is present in <em>all</em> sampled locations, its log probability of incidence is infinite. Infinity is nonsensical in an empirical comparison, so let’s screen out subsamples with those values (12 in total, of 1500 subsamples).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for infinity values of SCOR and remove them</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.infinite</span>(metaD<span class="sc">$</span>SCOR) <span class="sc">|&gt;</span> <span class="fu">any</span>() <span class="co"># none in deep habitat dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.infinite</span>(metaP<span class="sc">$</span>SCOR) <span class="sc">|&gt;</span> <span class="fu">any</span>() <span class="co"># but some in the prox habitat dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.infinite</span>(metaE<span class="sc">$</span>SCOR) <span class="sc">|&gt;</span> <span class="fu">any</span>() <span class="co"># and some in the all-habitats dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>infP <span class="ot">&lt;-</span> <span class="fu">is.infinite</span>(metaP<span class="sc">$</span>SCOR)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>metaP <span class="ot">&lt;-</span> metaP[ <span class="sc">!</span>infP, ]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>infE <span class="ot">&lt;-</span> <span class="fu">is.infinite</span>(metaE<span class="sc">$</span>SCOR)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>metaE <span class="ot">&lt;-</span> metaE[ <span class="sc">!</span>infE, ]</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(infP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(infE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p>For the permutation hypothesis tests below, it would be ideal for comparison groups to match in sample size. The previous step removed 10 samples from one group, 2 from another, and none from the third—a difference that could be remedied by omitting another 8 and 10 samples from the latter two groups, respectively. Samples could be selected at random. However, one could argue it would unfairly increase the odds of supporting the hypothesis of larger ranges in deep than shallow habitats to randomly omit 10 deep samples but selectively omit the 10 shallow samples where at least one taxon was universally distributed. For a conservative comparison, one could instead omit deep and eurytopic samples with largest values of SCOR.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make sample size (of subsamples) equal, by removing ones with largest SCOR</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>lowestN <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">nrow</span>(metaD), <span class="fu">nrow</span>(metaP), <span class="fu">nrow</span>(metaE))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>sortD <span class="ot">&lt;-</span> <span class="fu">order</span>(metaD<span class="sc">$</span>SCOR, <span class="at">decreasing =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>metaD <span class="ot">&lt;-</span> metaD[sortD, ]</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>metaD <span class="ot">&lt;-</span> metaD[<span class="dv">1</span><span class="sc">:</span>lowestN, ]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>sortE <span class="ot">&lt;-</span> <span class="fu">order</span>(metaE<span class="sc">$</span>SCOR, <span class="at">decreasing =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>metaE <span class="ot">&lt;-</span> metaE[sortE, ]</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>metaE <span class="ot">&lt;-</span> metaE[<span class="dv">1</span><span class="sc">:</span>lowestN, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ultimately, the choice of how to perform this selection step makes little difference to results, because it affects only 2% of subsamples.</p>
<p>At last we can compare the degree to which taxa of each ecological group are widespread, within normalised amounts of habitat. There are various test statistics one could calculate. Here are custom functions for a bootstrapping approach that capitalises on the existing division of subsamples to generate nonparametric estimates of how probable SCOR values from one group are to exceed those of another.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how often does the value in group 1 exceed that in group 2 paired samples?</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># randomly shuffle subsample ordering before comparing</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>testDiff <span class="ot">&lt;-</span> <span class="cf">function</span>(dat1, dat2, vTest){</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dat1)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  dat1 <span class="ot">&lt;-</span> dat1[ <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n), ]</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  dat2 <span class="ot">&lt;-</span> dat2[ <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n), ]</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  h1obs <span class="ot">&lt;-</span> dat1[, vTest] <span class="sc">&gt;</span> dat2[, vTest]</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(h1obs) <span class="sc">/</span> n</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat the comparison many times to generate a 95% confidence interval</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>diffDist <span class="ot">&lt;-</span> <span class="cf">function</span>(dat1, dat2, vTest, nReps){</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  testStatDist <span class="ot">&lt;-</span> <span class="fu">testDiff</span>(dat1, dat2, vTest) <span class="sc">|&gt;</span> <span class="fu">replicate</span>(<span class="at">n =</span> nReps)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  avg <span class="ot">&lt;-</span> <span class="fu">mean</span>(testStatDist)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  ci95 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  null95 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(testStatDist, ci95)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(null95) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'lwrCI'</span>, <span class="st">'uprCI'</span>)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(null95, <span class="st">'mean'</span> <span class="ot">=</span> avg)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When we apply the boostrapping test, the results indicate a random region of deep-water habitat contains more taxa with widespread ranges than a proximal habitat two-thirds of the time. Assemblages of eurytopic taxa from any random region almost always contained representatives with more widespread ranges than assemblages of either habitat specialist.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># do deep-water environments harbor more cosmopolitan taxa?</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diffDist</span>(metaD, metaP, <span class="at">vTest =</span> <span class="st">'SCOR'</span>, <span class="at">nReps =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    lwrCI     uprCI      mean 
0.6122449 0.6592347 0.6349163 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># what about eurytopic taxa vs. deep-water specialists?</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diffDist</span>(metaE, metaD, <span class="at">vTest =</span> <span class="st">'SCOR'</span>, <span class="at">nReps =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    lwrCI     uprCI      mean 
0.9755102 0.9938776 0.9844980 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># and if eurytopic species are more widespread than deep,</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># they'll also be more widespread than proximal-dwellers</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># (since more deep-water species are widespread than proximal are)</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">diffDist</span>(metaE, metaP, <span class="at">vTest =</span> <span class="st">'SCOR'</span>, <span class="at">nReps =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    lwrCI     uprCI      mean 
0.9816327 0.9979592 0.9894939 </code></pre>
</div>
</div>
<p>Another way one could compare SCOR between groups is inspecting the distribution of values in each comparison group. Overall, SCOR values from assemblages of deep-water taxa were slightly larger than those of proximal taxa, while eurytopic taxa were substantially more common than either of those groups (SCOR values 4–5 times as large). Again, note that because these results are derived from spatially standardised data, these numbers account for the fact that eurytopic taxa as defined here had many more cells of suitable habitat available to occupy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(metaD<span class="sc">$</span>SCOR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  2.183   3.174   3.689   3.700   4.153   5.878 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(metaP<span class="sc">$</span>SCOR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  1.090   2.028   3.297   3.135   3.942   5.550 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(metaE<span class="sc">$</span>SCOR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  3.383   9.796  15.042  14.959  19.822  28.715 </code></pre>
</div>
</div>
<section id="contrast-results-from-non-subsampled-data" class="level3">
<h3 class="anchored" data-anchor-id="contrast-results-from-non-subsampled-data">Contrast results from non-subsampled data</h3>
<p>What would the results and conclusions have been without going to the effort to spatially subsample the original occurrence data? For comparison with the average SCOR values listed above, the following code uses the <code>sdSumry()</code> function again, this time on the non-standardised full datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sdSumry</span>(deep, xyCell, <span class="st">'genus'</span>, prj) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     nOcc nLoc centroidX centroidY latRange greatCircDist meanPairDist
[1,]  713  250  -3192759  -1735760   166.32      33567.84       8071.8
     minSpanTree SCOR nTax
[1,]    130946.3    3   94</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sdSumry</span>(prox, xyCell, <span class="st">'genus'</span>, prj) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     nOcc nLoc centroidX centroidY latRange greatCircDist meanPairDist
[1,]  432  204  -3766508   -957619   166.32      33567.84      7845.98
     minSpanTree SCOR nTax
[1,]      127435 2.27   61</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sdSumry</span>(eury, xyCell, <span class="st">'genus'</span>, prj) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     nOcc nLoc centroidX centroidY latRange greatCircDist meanPairDist
[1,] 3462  404  -3134553  -1227392   166.32      33567.84      8321.72
     minSpanTree SCOR nTax
[1,]    168862.1 9.46  100</code></pre>
</div>
</div>
<p>In this case the overall direction of results is the same (deep-water taxa tend to be slightly more widespread than shallow-water taxa, and eurytopic taxa are most widespread of all). However, subsampling makes the difference between eurytopic taxa and specialists more pronounced—SCOR values from raw data are estimated about three times larger (rather than 4–5 times larger) compared to shallow- and deep-water taxa.</p>
</section>
</section>
<section id="average-taxon-range-size-between-environments" class="level2">
<h2 class="anchored" data-anchor-id="average-taxon-range-size-between-environments">7. Average taxon range size between environments</h2>
<p>The preceding section illustrates a way one might quantitatively compare an ecological variable calculated from assemblage or community data. There are many cases where one would be interested in a taxon-specific variable instead, e.g.&nbsp;body size or other traits. The present section demonstrates a way to extract and summarise focal taxon data from subsampled assemblage data. The trait of interest in this instance is geographic range size, which can be parameterised in a variety of ways. The <code>rangeSize()</code> function in <code>divvy</code> returns five measures of geographic distribution, two of which the following code compares between ecological study groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># custom function to find all occurrences of focal taxon in a subsample</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and return summary measures of geographic distribution from them</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>subsampRange <span class="ot">&lt;-</span> <span class="cf">function</span>(taxa, df, taxCol, coordCols, crs){</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  taxRange <span class="ot">&lt;-</span> <span class="cf">function</span>(taxon){</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    taxBool <span class="ot">&lt;-</span> df[, taxCol] <span class="sc">==</span> taxon</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(taxBool) <span class="sc">==</span> <span class="dv">0</span>){ <span class="co"># case where taxon unsampled</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">7</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>      taxCoords <span class="ot">&lt;-</span> df[taxBool, coordCols]</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rangeSize</span>(taxCoords, crs)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  taxa <span class="ot">&lt;-</span> <span class="fu">sort</span>(taxa)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  rngMat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(taxa, taxRange)</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(rngMat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'occurrences'</span>, <span class="st">'centroidX'</span>, <span class="st">'centroidY'</span>, <span class="st">'latRange'</span>,</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'greatCircDist'</span>, <span class="st">'meanPairDist'</span>, <span class="st">'minSpanTree'</span>)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  rngDf <span class="ot">&lt;-</span> <span class="fu">t</span>(rngMat) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>()</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(rngDf)</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="co"># run the function on all subsamples of each comparison set. warning:</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="co"># these are intensive computations so might be slow (minutes of runtime)</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>rngD <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sampD, <span class="at">FUN =</span> subsampRange, <span class="at">taxa =</span> taxa, <span class="at">taxCol =</span> <span class="st">'genus'</span>,</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">coordCols =</span> xyCell, <span class="at">crs =</span> prj)</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>rngP <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sampP, <span class="at">FUN =</span> subsampRange, <span class="at">taxa =</span> taxa, <span class="at">taxCol =</span> <span class="st">'genus'</span>,</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">coordCols =</span> xyCell, <span class="at">crs =</span> prj)</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>rngE <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sampE, <span class="at">FUN =</span> subsampRange, <span class="at">taxa =</span> taxa, <span class="at">taxCol =</span> <span class="st">'genus'</span>,</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">coordCols =</span> xyCell, <span class="at">crs =</span> prj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The above code chunk produces a <code>list</code> of range-size data for all genera in all subsamples. The lines below average all values for each focal taxon to consolidate these intermediate calculations into per-taxon range data for final analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize a focal species' range size data across all subsamples</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>taxRange <span class="ot">&lt;-</span> <span class="cf">function</span>(a, rngL, <span class="at">singletons =</span> <span class="cn">FALSE</span>){</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">lapply</span>(rngL, <span class="cf">function</span>(x){</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    aBool <span class="ot">&lt;-</span> <span class="fu">row.names</span>(x) <span class="sc">==</span> a</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    x[ aBool, ]</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  aDf <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, tmp)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># option: only consider subsamples where species is sampled multiple times</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (singletons <span class="sc">==</span> <span class="cn">FALSE</span>){</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    singl <span class="ot">&lt;-</span> aDf<span class="sc">$</span>occ <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    aDf <span class="ot">&lt;-</span> aDf[ <span class="sc">!</span>singl, ]</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colMeans</span>(aDf, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="co"># apply summary function over all taxa in subsamples of preferred enviro</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>rngAvgD <span class="ot">&lt;-</span> <span class="fu">sapply</span>(taxaD, taxRange, <span class="at">rngL =</span> rngD) <span class="sc">|&gt;</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">|&gt;</span> <span class="fu">data.frame</span>()</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>rngAvgP <span class="ot">&lt;-</span> <span class="fu">sapply</span>(taxaP, taxRange, <span class="at">rngL =</span> rngP) <span class="sc">|&gt;</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">|&gt;</span> <span class="fu">data.frame</span>()</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>rngAvgE <span class="ot">&lt;-</span> <span class="fu">sapply</span>(taxaE, taxRange, <span class="at">rngL =</span> rngE) <span class="sc">|&gt;</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">|&gt;</span> <span class="fu">data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are cases where a taxon is observed only once in a given subsample, which is uninformative for any geographic range measure except raw occurrence counts. The custom argument <code>singletons = FALSE</code> omits these cases from consideration for the focal taxon range-size average.</p>
<p>Some taxa are never observed multiple times even with many subsamples. After omitting these taxa, the sample size of genera in each comparison group shrinks to 43 in deep water, 24 in proximal habitats, and 95 occupying a breadth of depths.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>rngAvgD <span class="ot">&lt;-</span> rngAvgD[ <span class="fu">complete.cases</span>(rngAvgD), ]</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>rngAvgP <span class="ot">&lt;-</span> rngAvgP[ <span class="fu">complete.cases</span>(rngAvgP), ]</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>rngAvgE <span class="ot">&lt;-</span> rngAvgE[ <span class="fu">complete.cases</span>(rngAvgE), ]</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">list</span>(<span class="st">'D'</span> <span class="ot">=</span> rngAvgD, <span class="st">'P'</span> <span class="ot">=</span> rngAvgP, <span class="st">'E'</span> <span class="ot">=</span> rngAvgE), nrow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> D  P  E 
43 24 95 </code></pre>
</div>
</div>
<p>The previous section, assessing SCOR as an example of comparing assemblage-based metrics, demonstrated a bootstrapping approach to generate results. As a complementary example, the following chunk uses Frequentist two-sample tests to address each hypothesis. For simplicity, only two measure of geographic range are compared here (grid cell occupancy and summed length of minimum spanning tree); the reader could easily substitute any of the other three in the datasets (latitudinal range, great circle distance, and mean pairwise distance).</p>
<p>The occurrence or occupancy measure of range size is count data, so a Wilcoxon (Mann-Whitney) test is appropriate as a nonparametric test. The second range-size metric, summed length of minimum spanning tree, follows a normal distribution after square-root transformation; a student’s t-test makes parametric comparisons on it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(rngAvgD<span class="sc">$</span>occurrences, rngAvgP<span class="sc">$</span>occurrences, <span class="at">alternative=</span><span class="st">'g'</span>) <span class="co"># deep vs shallow</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in wilcox.test.default(rngAvgD$occurrences, rngAvgP$occurrences, :
cannot compute exact p-value with ties</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test with continuity correction

data:  rngAvgD$occurrences and rngAvgP$occurrences
W = 538, p-value = 0.3876
alternative hypothesis: true location shift is greater than 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(rngAvgE<span class="sc">$</span>occurrences, rngAvgD<span class="sc">$</span>occurrences, <span class="at">alternative=</span><span class="st">'g'</span>) <span class="co"># eurytopic vs deep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test with continuity correction

data:  rngAvgE$occurrences and rngAvgD$occurrences
W = 2794, p-value = 0.0002696
alternative hypothesis: true location shift is greater than 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(rngAvgE<span class="sc">$</span>occurrences, rngAvgP<span class="sc">$</span>occurrences, <span class="at">alternative=</span><span class="st">'g'</span>) <span class="co"># eurytopic vs shallow</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test with continuity correction

data:  rngAvgE$occurrences and rngAvgP$occurrences
W = 1603, p-value = 0.001076
alternative hypothesis: true location shift is greater than 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>rngAvgD<span class="sc">$</span>minSpanTree <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(rngAvgD<span class="sc">$</span>minSpanTree)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>rngAvgP<span class="sc">$</span>minSpanTree <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(rngAvgP<span class="sc">$</span>minSpanTree)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>rngAvgE<span class="sc">$</span>minSpanTree <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(rngAvgE<span class="sc">$</span>minSpanTree)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(rngAvgD<span class="sc">$</span>minSpanTree, rngAvgP<span class="sc">$</span>minSpanTree, <span class="at">alternative=</span><span class="st">'g'</span>) <span class="co"># deep vs shallow</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  rngAvgD$minSpanTree and rngAvgP$minSpanTree
t = 0.10779, df = 38.352, p-value = 0.4574
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 -3.728928       Inf
sample estimates:
mean of x mean of y 
 26.92918  26.67442 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(rngAvgE<span class="sc">$</span>minSpanTree, rngAvgD<span class="sc">$</span>minSpanTree, <span class="at">alternative=</span><span class="st">'g'</span>) <span class="co"># eurytopic vs deep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  rngAvgE$minSpanTree and rngAvgD$minSpanTree
t = 3.153, df = 82.129, p-value = 0.001129
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 2.119235      Inf
sample estimates:
mean of x mean of y 
 31.41559  26.92918 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(rngAvgE<span class="sc">$</span>minSpanTree, rngAvgD<span class="sc">$</span>minSpanTree, <span class="at">alternative=</span><span class="st">'g'</span>) <span class="co"># eurytopic vs shallow</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  rngAvgE$minSpanTree and rngAvgD$minSpanTree
t = 3.153, df = 82.129, p-value = 0.001129
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 2.119235      Inf
sample estimates:
mean of x mean of y 
 31.41559  26.92918 </code></pre>
</div>
</div>
<p>The results of per-taxon range size comparisons are less clear than those of assemblage-based SCOR comparisons above. There is no discernible difference in mean range size between deep- and shallow-water species whether measured as occurrence counts or minimum spanning tree distances. However, eurytopic taxa still measure larger than either specialist group, even by conservative thresholds for significance: eurytopic taxa occur in nearly one more grid cell of the 15 in every subsample, and span about 270 km farther in tree length connecting occupied cells. (Recall the tree lengths printed here are square-root transformed.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'occurrences'</span>, <span class="st">'minSpanTree'</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">list</span>(<span class="st">'D'</span> <span class="ot">=</span> rngAvgD, <span class="st">'P'</span> <span class="ot">=</span> rngAvgP, <span class="st">'E'</span> <span class="ot">=</span> rngAvgE),</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>       <span class="cf">function</span>(x) <span class="fu">apply</span>(x[,vars], <span class="dv">2</span>, mean)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>       )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    D         P        E
occurrences  2.863038  2.898537  3.66210
minSpanTree 26.929182 26.674421 31.41559</code></pre>
</div>
</div>
<section id="contrast-results-from-non-subsampled-data-1" class="level3">
<h3 class="anchored" data-anchor-id="contrast-results-from-non-subsampled-data-1">Contrast results from non-subsampled data</h3>
<p>As with the assemblage-based analysis above, we can investigate the inferences that would have resulted from analysing the original occurrence data, without subsampling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate geographic range size on alloccurrences (not subsampled)</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>unsamp <span class="ot">&lt;-</span> <span class="fu">subsampRange</span>(taxa, <span class="at">df =</span> occSilur, <span class="at">taxCol =</span> <span class="st">'genus'</span>, <span class="at">coordCols =</span> xyCell, <span class="at">crs =</span> prj)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>unsampD <span class="ot">&lt;-</span> unsamp[<span class="fu">rownames</span>(unsamp) <span class="sc">%in%</span> taxaD,]</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>unsampP <span class="ot">&lt;-</span> unsamp[<span class="fu">rownames</span>(unsamp) <span class="sc">%in%</span> taxaP,]</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>unsampE <span class="ot">&lt;-</span> unsamp[<span class="fu">rownames</span>(unsamp) <span class="sc">%in%</span> taxaE,]</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(unsampD<span class="sc">$</span>occurrences, unsampP<span class="sc">$</span>occurrences, <span class="at">alternative=</span><span class="st">'g'</span>) <span class="co"># deep vs shallow</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test with continuity correction

data:  unsampD$occurrences and unsampP$occurrences
W = 2778, p-value = 0.6299
alternative hypothesis: true location shift is greater than 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(unsampE<span class="sc">$</span>occurrences, unsampD<span class="sc">$</span>occurrences, <span class="at">alternative=</span><span class="st">'g'</span>) <span class="co"># eurytopic vs deep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test with continuity correction

data:  unsampE$occurrences and unsampD$occurrences
W = 7878, p-value &lt; 2.2e-16
alternative hypothesis: true location shift is greater than 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(unsampE<span class="sc">$</span>occurrences, unsampP<span class="sc">$</span>occurrences, <span class="at">alternative=</span><span class="st">'g'</span>) <span class="co"># eurytopic vs shallow</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test with continuity correction

data:  unsampE$occurrences and unsampP$occurrences
W = 5177.5, p-value = 5.463e-14
alternative hypothesis: true location shift is greater than 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>unsampE<span class="sc">$</span>minSpanTree <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(unsampE<span class="sc">$</span>minSpanTree)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>unsampD<span class="sc">$</span>minSpanTree <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(unsampD<span class="sc">$</span>minSpanTree)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>unsampP<span class="sc">$</span>minSpanTree <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(unsampP<span class="sc">$</span>minSpanTree)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(unsampD<span class="sc">$</span>minSpanTree, unsampP<span class="sc">$</span>minSpanTree, <span class="at">alternative=</span><span class="st">'g'</span>) <span class="co"># deep vs shallow</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  unsampD$minSpanTree and unsampP$minSpanTree
t = 1.4578, df = 128.32, p-value = 0.07368
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 -2.172339       Inf
sample estimates:
mean of x mean of y 
105.78370  89.87555 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(unsampE<span class="sc">$</span>minSpanTree, unsampD<span class="sc">$</span>minSpanTree, <span class="at">alternative=</span><span class="st">'g'</span>) <span class="co"># eurytopic vs deep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  unsampE$minSpanTree and unsampD$minSpanTree
t = 5.5061, df = 169.6, p-value = 6.687e-08
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 41.22068      Inf
sample estimates:
mean of x mean of y 
 164.7019  105.7837 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(unsampE<span class="sc">$</span>minSpanTree, unsampD<span class="sc">$</span>minSpanTree, <span class="at">alternative=</span><span class="st">'g'</span>) <span class="co"># eurytopic vs shallow</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  unsampE$minSpanTree and unsampD$minSpanTree
t = 5.5061, df = 169.6, p-value = 6.687e-08
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 41.22068      Inf
sample estimates:
mean of x mean of y 
 164.7019  105.7837 </code></pre>
</div>
</div>
<p>In the bootstrapped analysis of SCOR values, subsampling happened to amplify the differences between comparison groups. In the Frequentist analysis of per-taxon range size in this section, subsampling reduced the quantitative magnitude of differences between comparison groups. To some extent, this muting of absolute differences makes sense given the inherent truncation of geographic ranges due to subsampling. However, looking back at the <a href="#raster_map">map of PBDB data distribution</a>, it is also possible to hypothesise that biased sampling artificially inflated group differences. For instance, as noted when plotting the map, sampling coverage of deep-water habitats extends much farther around Laurasia compared to shallow-water habitats. Without accounting for this influence, it is impossible to attribute the greater minimum spanning tree length of deep-water species to ecology alone. After subsampling, although there may be fewer results that are clear, the analyst can trust the results that do emerge as meaningful for biological interpretation.</p>
</section>
</section>
<section id="references" class="level2 unnumbered">


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">8. References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Allmon2014" class="csl-entry" role="listitem">
Allmon, Warren D, and Ronald E Martin. 2014. <span>“Seafood Through Time Revisited: The Phanerozoic Increase in Marine Trophic Resources and Its Macroevolutionary Consequences.”</span> Journal Article. <em>Paleobiology</em> 40 (2): 256–87.
</div>
<div id="ref-Antell2023" class="csl-entry" role="listitem">
Antell, Gawain T, Roger BJ Benson, and Erin E Saupe. accepted. <span>“Spatial Standardization of Taxon Occurrence Data—a Call to Action.”</span> Journal Article. <em>Paleobiology</em>, accepted. <a href="https://doi.org/10.31223/X5997Z">https://doi.org/10.31223/X5997Z</a>.
</div>
<div id="ref-Antell2020" class="csl-entry" role="listitem">
Antell, Gawain T, Wolfgang Kiessling, Martin Aberhan, and Erin E Saupe. 2020. <span>“Marine Biodiversity and Geographic Distributions Are Independent on Large Scales.”</span> Journal Article. <em>Current Biology</em> 30 (1): 115–21.
</div>
<div id="ref-Close2020" class="csl-entry" role="listitem">
Close, Roger A, Roger BJ Benson, Erin E Saupe, Michael E Clapham, and Richard J Butler. 2020. <span>“The Spatial Structure of Phanerozoic Marine Animal Diversity.”</span> Journal Article. <em>Science</em> 368 (6489): 420–24.
</div>
<div id="ref-Close2017" class="csl-entry" role="listitem">
Close, Roger A, Roger BJ Benson, Paul Upchurch, and Richard J Butler. 2017. <span>“Controlling for the Species-Area Effect Supports Constrained Long-Term Mesozoic Terrestrial Vertebrate Diversification.”</span> <em>Nature Communications</em> 8 (1): 15381.
</div>
<div id="ref-Coe1946" class="csl-entry" role="listitem">
Coe, Wesley R. 1946. <span>“The Means of Dispersal of Bathypelagic Animals in the North and South Atlantic Oceans.”</span> Journal Article. <em>The American Naturalist</em> 80 (793): 453–69.
</div>
<div id="ref-Costello2017" class="csl-entry" role="listitem">
Costello, Mark J, and Chhaya Chaudhary. 2017. <span>“Marine Biodiversity, Biogeography, Deep-Sea Gradients, and Conservation.”</span> Journal Article. <em>Current Biology</em> 27 (11): R511–27.
</div>
<div id="ref-Duran2018" class="csl-entry" role="listitem">
Durán, Ruth, and Jorge Guillén. 2018. <span>“Continental Shelf Landforms.”</span> In <em>Submarine Geomorphology</em>, edited by Aaron Micallef, Sebastian Krastel, and Alessandra Savini, 185–206. Springer.
</div>
<div id="ref-fossilbrush" class="csl-entry" role="listitem">
Flannery-Sutherland, Joe, Nussaïbah Raja-Schoob, Ádam Kocsis, and Wolfgang Kiessling. 2022. <em>Fossilbrush: Automated Cleaning of Fossil Occurrence Data</em>. <a href="https://CRAN.R-project.org/package=fossilbrush">https://CRAN.R-project.org/package=fossilbrush</a>.
</div>
<div id="ref-Gaston2003" class="csl-entry" role="listitem">
Gaston, Kevin J. 2003. <em>The Structure and Dynamics of Geographic Ranges</em>. Book. Oxford University Press.
</div>
<div id="ref-Hannisdal2012" class="csl-entry" role="listitem">
Hannisdal, Bjarte, Jorijntje Henderiks, and Lee Hsiang Liow. 2012. <span>“Long-Term Evolutionary and Ecological Responses of Calcifying Phytoplankton to Changes in Atmospheric CO2.”</span> <em>Global Change Biology</em> 18 (12): 3504–16.
</div>
<div id="ref-Hansen1980" class="csl-entry" role="listitem">
Hansen, Thor A. 1980. <span>“Influence of Larval Dispersal and Geographic Distribution on Species Longevity in Neogastropods.”</span> Journal Article. <em>Paleobiology</em>, 193–207.
</div>
<div id="ref-Harnik2012" class="csl-entry" role="listitem">
Harnik, Paul G, Carl Simpson, and Jonathan L Payne. 2012. <span>“Long-Term Differences in Extinction Risk Among the Seven Forms of Rarity.”</span> Journal Article. <em>Proceedings of the Royal Society B: Biological Sciences</em> 279 (1749): 4969–76.
</div>
<div id="ref-Jablonski2003" class="csl-entry" role="listitem">
Jablonski, David, and Kaustuv Roy. 2003. <span>“Geographical Range and Speciation in Fossil and Living Molluscs.”</span> Journal Article. <em>Proceedings of the Royal Society B: Biological Sciences</em> 270 (1513): 401–6.
</div>
<div id="ref-Maurer2001" class="csl-entry" role="listitem">
Maurer, Brian A, and M Philip Nott. 2001. <span>“Geographic Range Fragmentation and the Evolution of Biological Diversity.”</span> Book Section. In <em>Biodiversity Dynamics</em>, edited by Michael L McKinney and James A Drake, 31–50. Columbia University Press.
</div>
<div id="ref-McClain2010" class="csl-entry" role="listitem">
McClain, Craig R, and Sarah Mincks Hardy. 2010. <span>“The Dynamics of Biogeographic Ranges in the Deep Sea.”</span> Journal Article. <em>Proceedings of the Royal Society B: Biological Sciences</em> 277 (1700): 3533–46.
</div>
<div id="ref-Nurnberg2013" class="csl-entry" role="listitem">
Nürnberg, Sabine, and Martin Aberhan. 2013. <span>“Habitat Breadth and Geographic Range Predict Diversity Dynamics in Marine Mesozoic Bivalves.”</span> Journal Article. <em>Paleobiology</em> 39 (3): 360–72.
</div>
<div id="ref-Rojas2021" class="csl-entry" role="listitem">
Rojas, Alexis, Joaquin Calatayud, Michał Kowalewski, Magnus Neuman, and Martin Rosvall. 2021. <span>“A Multiscale View of the Phanerozoic Fossil Record Reveals the Three Major Biotic Transitions.”</span> <em>Communications Biology</em> 4 (1): 1–8.
</div>
<div id="ref-Rosenzweig1995" class="csl-entry" role="listitem">
Rosenzweig, Michael L. 1995. <em>Species Diversity in Space and Time</em>. Book. Cambridge University Press.
</div>
<div id="ref-Saupe2015" class="csl-entry" role="listitem">
Saupe, Erin E, Huijie Qiao, Jonathan R Hendricks, Roger W Portell, Stephen J Hunter, Jorge Soberón, and Bruce S Lieberman. 2015. <span>“Niche Breadth and Geographic Range Size as Determinants of Species Survival on Geological Time Scales.”</span> Journal Article. <em>Global Ecology and Biogeography</em> 24 (10): 1159–69.
</div>
<div id="ref-Scotese2016" class="csl-entry" role="listitem">
Scotese, Christopher R. 2016. <span>“PALEOMAP PaleoAtlas for GPlates and the PaleoData Plotter Program.”</span> <a href="https://www.earthbyte.org/webdav/ftp/earthbyte/Scotese_PaleoAtlas_v3.zip">https://www.earthbyte.org/webdav/ftp/earthbyte/Scotese_PaleoAtlas_v3.zip</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>